# O2Any 小红书/知乎扩展方案（半自动）

## 背景与约束
- 公众号链路已稳定，本次扩展不改公众号逻辑。
- 新功能在 `feature/xhs-zhihu` 分支实现，保证主分支稳定。
- 小红书/知乎缺乏稳定开放发布 API，优先采用“半自动导出 + 一键复制 + 跳转平台”方案。

## 目标
- 在 O2Any 中新增“小红书”和“知乎”两个发布面板。
- 通过统一的转换逻辑输出平台适配内容。
- 提供清晰的导出产物与操作引导，减少手工成本。

## 核心原则
1. **不动公众号主链路**：公众号相关渲染、上传、草稿流程保持原样。
2. **平台解耦**：新增平台走独立适配器，不污染现有代码。
3. **半自动优先**：不依赖不稳定的第三方发布 API。
4. **可回溯与可扩展**：后续新增掘金/头条可沿用同一结构。

## 功能范围
### 小红书
- 输出适配的“纯文本内容”。
- 提供“导出素材包”：文案 + 图片序列 + 上传顺序说明。
- 一键复制文案 + 打开小红书创作平台页面。

### 知乎
- 输出适配的 HTML 或 Markdown（默认 HTML）。
- 一键复制内容 + 打开知乎专栏写作页。
- 可选：导出 HTML 文件，便于浏览器直接粘贴。

## 统一内容处理管线（建议结构）
```
Markdown -> 中间结构 IR -> 平台适配器 -> 导出/复制
```
- **IR（中间结构）**：标题、段落、列表、引用、代码块、图片等基础块。
- **平台适配器**：根据平台规则进行格式化（文本/HTML/Markdown）。
- **资源处理**：小红书导出图片序列；知乎保持原图引用或走图床。

## 小红书适配细则（可落地）
### 1) 文本转换规则
- 一级标题：`✨ 标题`
- 二级标题：`🔹 小标题`
- 无序列表：`▫️` 前缀
- 有序列表：使用 emoji 序号（1️⃣ 2️⃣ 3️⃣）
- 任务列表：`✅ / 🔲`
- 引用：缩进 + 分隔线
- 表格：转为多行文本块
- 链接：`描述（链接：URL）`
- 图片：插入占位符 `【图1】`、`【图2】`

### 2) 素材包导出结构
```
小红书导出/文章标题-日期/
  - 文案.txt
  - 图片/
      01-xxx.png
      02-xxx.png
  - 上传顺序.txt
```

### 3) 交互流程
1. 选择笔记 -> 点击“导出小红书”
2. 自动生成素材包
3. 自动复制文案到剪贴板
4. 打开 `https://creator.xiaohongshu.com/`
5. 按“上传顺序.txt”上传图片并粘贴文案

## 知乎适配细则（可落地）
### 1) 输出形态
- 默认输出 HTML（与公众号渲染链路一致，样式可控）。
- 可选输出 Markdown（知乎编辑器兼容性较弱）。

### 2) 交互流程
1. 选择笔记 -> 点击“复制知乎内容”
2. 自动复制 HTML 到剪贴板
3. 打开 `https://zhuanlan.zhihu.com/write`
4. 粘贴并发布

## UI 与交互设计
- 预览器新增 Tabs：公众号 / 小红书 / 知乎。
- 每个平台面板提供统一按钮组：
  - 刷新
  - 复制
  - 打开平台
  - 导出（小红书有“素材包导出”）
- 移动端限制：
  - 无法打开外部链接时提示复制链接
  - 无法复制时提示手动选择文本

## 数据与配置设计
### frontmatter（可选）
```
发布:
  知乎:
    url: https://zhuanlan.zhihu.com/p/xxxx
  小红书:
    素材路径: 小红书导出/xxx
```
> 仅用于记录，不影响渲染。

## 文件改造清单（建议）
1. `src/platforms/zhihu/zhihu-render.ts`  
   - HTML 输出与复制
2. `src/platforms/redbook/redbook-parser.ts`  
   - 小红书文本规则转换
3. `src/platforms/redbook/redbook-export.ts`  
   - 文案 + 图片导出
4. `src/views/previewer.ts`  
   - 新增 Tabs 与按钮
5. `src/lang/locales/zh-cn.json`  
   - 新增文案
6. `src/utils/export.ts`  
   - 导出目录与文件写入

## 分阶段开发计划
### 阶段 1（最小可用）
- 小红书纯文本导出
- 知乎 HTML 复制
- UI 面板 + 按钮

### 阶段 2（可用增强）
- 小红书素材包导出（图片+顺序）
- 前端提示与引导文案优化

### 阶段 3（体验完善）
- 话题标签建议
- 图片尺寸统一与压缩
- 导出模板可配置

## 风险与限制
- 小红书/知乎无官方 API，不保证自动发布。
- 小红书图片上传需人工完成。
- 复制粘贴在移动端可能受限，需要提示引导。

## 验收标准
- 小红书：能生成文案与素材包，用户可按指引完成发布。
- 知乎：能复制并在知乎编辑器正确粘贴。
- 公众号逻辑不受影响。
