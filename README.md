# O2Any

O2Any 是一款 Obsidian 插件，用于将 Markdown 渲染为微信公众号兼容的 HTML，支持预览排版、封面图与摘要、图片自动上传，以及一键发送到微信公众号草稿箱。

## 一、插件能做什么
- 在 Obsidian 中把 Markdown 渲染成微信公众号兼容的 HTML
- 预览排版、设置封面图与摘要
- 一键发送到微信公众号草稿箱
- 支持公众号名片、主题样式表与图片自动上传

## 二、安装方式

### 方式 A：社区插件市场（推荐）
1. Obsidian 设置 → 第三方插件 → 关闭安全模式。
2. 浏览社区插件，搜索 `O2Any`。
3. 安装并启用。

### 方式 B：手动安装
1. 打开仓库：`https://github.com/ryfineZ/O2Any-Obsdian`。
2. 进入发布页，下载 `main.js`、`manifest.json`、`styles.css`。
3. 在你的库内创建目录：`.obsidian/plugins/o2any-obsdian/`。
4. 把以上三个文件放进去。
5. 回到 Obsidian → 第三方插件 → 启用 `O2Any`。

## 三、微信公众号账号配置（AppID / AppSecret）
1. 打开微信开发者平台：`https://developers.weixin.qq.com/console/`。
2. 进入「公众号」→「基础信息」，找到 AppID 与 AppSecret。
3. Obsidian → 设置 → O2Any：
   - 新建账号
   - 填写「公众号名称」「AppID」「AppSecret」
   - 点「测试连接」确认可用

### IP 白名单（必须）
公众号接口要求 IP 白名单，否则无法上传图片或发布草稿。
1. 设置页会显示「公网 IP」或「直连/代理 IP」。
2. 在公众号后台「开发者中心」把显示的 IP 全部加入白名单。

## 四、打开预览器
1. 点击左侧工具栏的 O2Any 图标，或运行命令「文章渲染预览」。
2. 顶部可切换公众号账号。
3. 右上角按钮：
   - 设置：打开发布配置
   - 刷新：重新渲染
   - 复制：复制 HTML 到剪贴板
   - 发送：发送到草稿箱

## 五、封面图与摘要
封面图是必须项。推荐直接拖拽图片到预览器的封面区域。
- 支持从库内拖拽图片
- 支持输入网络图片链接
- 会自动写入 Properties（frontmatter）的「封面图」

摘要可在预览器右侧输入，保存后也会同步到 Properties。

## 六、Properties（frontmatter）支持字段
建议使用中文键名（与公众号一致）：

```md
---
标题: 这是标题
作者: 张三
摘要: 一句话摘要
原文链接: https://example.com
封面图: vault:路径/图片.png
开启评论: 是
仅粉丝可评论: 否
---
```

### 说明
- 「封面图」支持 `vault:相对路径` 或 `http/https` 链接
- 「开启评论 / 仅粉丝可评论」支持：`是/否`、`开启/关闭`、`1/0`、`true/false`

## 七、主题样式表
1. 设置 → 主题样式表 → 选择存放目录（建议在库内建一个主题文件夹）。
2. 点击下载按钮，下载官方提供的主题。
3. 在预览器顶部下拉选择主题。

如果你自己制作主题，请在主题文件的头部增加：
```md
---
theme_name: 你的主题名字
---
```

## 八、公众号名片（重点）
公众号名片必须是微信官方编辑器生成的 HTML 结构，手写内容无法正常跳转。

### 1. 安装名片提取浏览器插件
插件仓库：`https://github.com/ryfineZ/wechat-mpcard-extension`

安装步骤（Chrome/Edge）：
1. 打开 `chrome://extensions` 或 `edge://extensions`。
2. 开启「开发者模式」。
3. 点击「加载已解压的扩展程序」，选择下载解压后的 `wechat-mpcard-extension` 目录。

### 2. 获取公众号名片 HTML
1. 打开微信公众号后台的编辑器。
2. 手动插入一次「公众号名片」。
3. 点击浏览器右上角插件图标，复制名片 HTML。

### 3. 录入到 O2Any
1. 预览器右上角 → 设置（发布配置）。
2. 在「公众号名片配置」里粘贴 HTML。
3. 点击「解析并保存」。

### 4. 在文章中插入名片
1. 在编辑器里右键 →「插入公众号名片」。
2. 会自动插入 ` ```mpcard ` 代码块。
3. 发送草稿后会渲染为可点击名片。

## 九、发送草稿与预览
1. 先确保封面图已设置。
2. 点击「发送文章到草稿」。
3. 成功后会打开公众号预览链接。

### 预览草稿（可选）
1. 发布配置里填写「草稿预览者微信 ID」。
2. 点击「预览草稿」。
3. 若提示「api 功能未授权」，说明账号未开通草稿预览接口权限。

## 十、图片与附件
发送草稿时会自动上传文章中的图片。
如果图片上传失败，请检查：
- AppID / AppSecret 是否正确
- IP 是否已加入白名单
- 图片是否为库内真实存在的文件

## 十一、外链说明
微信公众号对外链限制较多，O2Any 会把外链显示为文本链接（加粗并括号包裹），并在文末附外链列表，方便读者复制。

## 十二、常见问题
**1. 提示 AppSecret 错误或 token 无效**  
请重新在微信开发者平台复制 AppSecret，确认无多余空格。

**2. 图片不显示 / 上传失败**  
请先配置 IP 白名单，并确认账号已开通相关接口权限。

**3. 预览草稿失败**  
需要账号具备「草稿预览」接口权限，且预览者微信 ID 必须关注公众号。

---

- 插件仓库：`https://github.com/ryfineZ/O2Any-Obsdian`
- 名片提取插件：`https://github.com/ryfineZ/wechat-mpcard-extension`
